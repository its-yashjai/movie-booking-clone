{% extends 'base/base.html' %}

{% block title %}My Profile - BookMyshowClone{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-md-3 mb-4">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <!-- Profile Avatar -->
                    <div class="text-center mb-4">
                        <div class="bg-gradient rounded-circle d-inline-flex align-items-center justify-content-center" 
                             style="width: 100px; height: 100px; font-size: 2.5rem; background: linear-gradient(135deg, #f84464 0%, #d6336c 100%); color: white;">
                            <i class="fas fa-user"></i>
                        </div>
                        <h5 class="mt-3 mb-0">{{ username }}</h5>
                        <small class="text-muted">{{ email }}</small>
                    </div>
                    
                    <hr>
                    
                    <!-- Navigation Menu -->
                    <nav class="nav flex-column">
                        <a class="nav-link active ps-0" href="#profile-info" data-bs-toggle="pill">
                            <i class="fas fa-user me-2 text-danger"></i> Profile Information
                        </a>
                        <a class="nav-link ps-0" href="#change-password" data-bs-toggle="pill">
                            <i class="fas fa-lock me-2 text-danger"></i> Change Password
                        </a>
                        <a class="nav-link ps-0" href="#security" data-bs-toggle="pill">
                            <i class="fas fa-shield-alt me-2 text-danger"></i> Security
                        </a>
                        <a class="nav-link ps-0" href="#account-actions" data-bs-toggle="pill">
                            <i class="fas fa-cog me-2 text-danger"></i> Account Actions
                        </a>
                    </nav>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="col-md-9">
            <div class="tab-content">
                <!-- Profile Information Tab -->
                <div class="tab-pane fade show active" id="profile-info">
                    <div class="card shadow-sm border-0 mb-4">
                        <div class="card-header bg-white border-bottom">
                            <h5 class="mb-0">
                                <i class="fas fa-user text-danger me-2"></i> Profile Information
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label class="form-label text-muted small fw-600">Username</label>
                                    <p class="h6">{{ username }}</p>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label text-muted small fw-600">Account Type</label>
                                    <p class="h6">
                                        {% if is_staff == 'Yes' %}
                                        <span class="badge bg-success">Staff Member</span>
                                        {% endif %}
                                        {% if is_superuser == 'Yes' %}
                                        <span class="badge bg-danger ms-1">Superuser</span>
                                        {% endif %}
                                        {% if is_staff == 'No' and is_superuser == 'No' %}
                                        <span class="badge bg-primary">Regular User</span>
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                            
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label class="form-label text-muted small fw-600">
                                        <i class="fas fa-envelope me-1"></i> Email Address
                                    </label>
                                    <p class="h6">{{ email }}</p>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label text-muted small fw-600">
                                        <i class="fas fa-calendar-check me-1"></i> Account Created
                                    </label>
                                    <p class="h6">{{ date_joined }}</p>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-12">
                                    <label class="form-label text-muted small fw-600">
                                        <i class="fas fa-clock me-1"></i> Last Login
                                    </label>
                                    <p class="h6">{{ last_login }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Profile Stats -->
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="card shadow-sm border-0 text-center">
                                <div class="card-body">
                                    <i class="fas fa-ticket-alt fa-2x text-danger mb-3"></i>
                                    <h6 class="text-muted mb-2">Total Bookings</h6>
                                    <h3 class="mb-0">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card shadow-sm border-0 text-center">
                                <div class="card-body">
                                    <i class="fas fa-coins fa-2x text-success mb-3"></i>
                                    <h6 class="text-muted mb-2">Total Spent</h6>
                                    <h3 class="mb-0">₹0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card shadow-sm border-0 text-center">
                                <div class="card-body">
                                    <i class="fas fa-star fa-2x text-warning mb-3"></i>
                                    <h6 class="text-muted mb-2">Loyalty Points</h6>
                                    <h3 class="mb-0">0</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Change Password Tab -->
                <div class="tab-pane fade" id="change-password">
                    <div class="card shadow-sm border-0">
                        <div class="card-header bg-white border-bottom">
                            <h5 class="mb-0">
                                <i class="fas fa-lock text-danger me-2"></i> Change Password
                            </h5>
                        </div>
                        <div class="card-body">
                            <form method="POST" action="{% url 'change_password' %}">
                                {% csrf_token %}
                                
                                <!-- Current Password -->
                                <div class="mb-4">
                                    <label for="current_password" class="form-label fw-600">
                                        <i class="fas fa-key me-2"></i> Current Password
                                    </label>
                                    <input type="password" name="current_password" class="form-control form-control-lg" 
                                           id="current_password" placeholder="Enter your current password" required>
                                    <small class="form-text text-muted d-block mt-2">
                                        We need your current password for security verification
                                    </small>
                                </div>
                                
                                <!-- New Password -->
                                <div class="mb-4">
                                    <label for="new_password1" class="form-label fw-600">
                                        <i class="fas fa-lock me-2"></i> New Password
                                    </label>
                                    <input type="password" name="new_password1" class="form-control form-control-lg" 
                                           id="new_password1" placeholder="Enter new password (min. 8 characters)" required>
                                    <small class="form-text text-muted d-block mt-2">
                                        Password must be at least 8 characters long
                                    </small>
                                </div>
                                
                                <!-- Confirm New Password -->
                                <div class="mb-4">
                                    <label for="new_password2" class="form-label fw-600">
                                        <i class="fas fa-check-circle me-2"></i> Confirm New Password
                                    </label>
                                    <input type="password" name="new_password2" class="form-control form-control-lg" 
                                           id="new_password2" placeholder="Confirm your new password" required>
                                </div>
                                
                                <!-- Password Strength -->
                                <div class="alert alert-info mb-4" role="alert">
                                    <i class="fas fa-shield-alt me-2"></i>
                                    <strong>Password Requirements:</strong>
                                    <ul class="mb-0 mt-2">
                                        <li>At least 8 characters long</li>
                                        <li>Mix of uppercase and lowercase letters</li>
                                        <li>Include numbers or special characters</li>
                                    </ul>
                                </div>
                                
                                <!-- Submit Button -->
                                <button type="submit" class="btn btn-danger btn-lg w-100" id="changePasswordBtn">
                                    <span class="btn-text">
                                        <i class="fas fa-check me-2"></i> Update Password
                                    </span>
                                    <span class="btn-loading" style="display: none;">
                                        <i class="fas fa-spinner fa-spin me-2"></i> Updating...
                                    </span>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Security Tab -->
                <div class="tab-pane fade" id="security">
                    <div class="card shadow-sm border-0">
                        <div class="card-header bg-white border-bottom">
                            <h5 class="mb-0">
                                <i class="fas fa-shield-alt text-danger me-2"></i> Security Settings
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- Email Verification -->
                            <div class="d-flex justify-content-between align-items-center mb-4 pb-4 border-bottom">
                                <div>
                                    <h6 class="mb-1">Email Verification</h6>
                                    <small class="text-muted">Verified email address is required for account security</small>
                                </div>
                                <span class="badge bg-success">
                                    <i class="fas fa-check me-1"></i> Verified
                                </span>
                            </div>
                            
                            <!-- Two Factor Authentication (Future) -->
                            <div class="d-flex justify-content-between align-items-center mb-4 pb-4 border-bottom">
                                <div>
                                    <h6 class="mb-1">Two-Factor Authentication</h6>
                                    <small class="text-muted">Add an extra layer of security to your account</small>
                                </div>
                                <button class="btn btn-sm btn-outline-primary" disabled>
                                    <i class="fas fa-lock me-1"></i> Coming Soon
                                </button>
                            </div>
                            
                            <!-- Login Sessions -->
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Active Sessions</h6>
                                    <small class="text-muted">Manage your active login sessions</small>
                                </div>
                                <button class="btn btn-sm btn-outline-secondary" disabled>
                                    <i class="fas fa-computer me-1"></i> Coming Soon
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Account Actions Tab -->
                <div class="tab-pane fade" id="account-actions">
                    <div class="card shadow-sm border-0">
                        <div class="card-header bg-white border-bottom">
                            <h5 class="mb-0">
                                <i class="fas fa-cog text-danger me-2"></i> Account Actions
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- Logout -->
                            <div class="d-flex justify-content-between align-items-center mb-4 pb-4 border-bottom">
                                <div>
                                    <h6 class="mb-1">Logout</h6>
                                    <small class="text-muted">Sign out of your account</small>
                                </div>
                                <a href="{% url 'logout' %}" class="btn btn-sm btn-outline-danger">
                                    <i class="fas fa-sign-out-alt me-1"></i> Logout
                                </a>
                            </div>
                            
                            <!-- Delete Account -->
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1 text-danger">Delete Account</h6>
                                    <small class="text-muted">Permanently delete your account and all data</small>
                                </div>
                                <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                                    <i class="fas fa-trash me-1"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header border-danger">
                <h5 class="modal-title text-danger" id="deleteAccountModalLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i> Delete Account
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p><strong>⚠️ Warning: This action cannot be undone!</strong></p>
                <p>Deleting your account will:</p>
                <ul>
                    <li>Permanently delete your account and profile</li>
                    <li>Remove all your booking history</li>
                    <li>Delete any saved preferences</li>
                </ul>
                <p class="text-muted">Please consider carefully before proceeding.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a href="#" class="btn btn-danger">
                    <i class="fas fa-trash me-2"></i> Yes, Delete My Account
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    .form-control-lg {
        height: 50px;
        border-radius: 6px;
        border: 1px solid #dee2e6;
        transition: all 0.3s ease;
    }
    
    .form-control-lg:focus {
        border-color: #f84464;
        box-shadow: 0 0 0 0.2rem rgba(248, 68, 100, 0.25);
    }
    
    .nav-link {
        color: #495057;
        border-radius: 6px;
        transition: all 0.3s ease;
        padding: 0.75rem 0 !important;
        border-left: 3px solid transparent;
    }
    
    .nav-link:hover {
        color: #f84464;
        background-color: #f8f9fa;
        padding-left: 0.5rem !important;
    }
    
    .nav-link.active {
        color: #f84464;
        background-color: transparent;
        border-left: 3px solid #f84464;
        font-weight: 600;
    }
    
    .card {
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    
    .card:hover {
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
    }
    
    .bg-gradient {
        background: linear-gradient(135deg, #f84464 0%, #d6336c 100%);
    }
    
    .btn-loading-state {
        opacity: 0.8;
        cursor: not-allowed !important;
    }
</style>

<script>
    // Handle pill navigation
    document.querySelectorAll('[data-bs-toggle="pill"]').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = this.getAttribute('href');
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('show', 'active');
            });
            document.querySelectorAll('.nav-link').forEach(navLink => {
                navLink.classList.remove('active');
            });
            document.querySelector(target).classList.add('show', 'active');
            this.classList.add('active');
        });
    });
    
    // Change password form loading
    document.addEventListener('DOMContentLoaded', function() {
        const changePasswordForm = document.querySelector('form[action*="change_password"]');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        
        if (changePasswordForm && changePasswordBtn) {
            const btnText = changePasswordBtn.querySelector('.btn-text');
            const btnLoading = changePasswordBtn.querySelector('.btn-loading');
            
            changePasswordForm.addEventListener('submit', function(e) {
                const currentPassword = document.getElementById('current_password').value;
                const newPassword1 = document.getElementById('new_password1').value;
                const newPassword2 = document.getElementById('new_password2').value;
                
                // Basic validation
                if (!currentPassword || !newPassword1 || !newPassword2) {
                    e.preventDefault();
                    alert('Please fill in all password fields');
                    return;
                }
                
                if (newPassword1 !== newPassword2) {
                    e.preventDefault();
                    alert('New passwords do not match');
                    return;
                }
                
                if (newPassword1.length < 8) {
                    e.preventDefault();
                    alert('New password must be at least 8 characters long');
                    return;
                }
                
                // Show loading state
                btnText.style.display = 'none';
                btnLoading.style.display = 'inline-block';
                changePasswordBtn.disabled = true;
                changePasswordBtn.classList.add('btn-loading-state');
                
                // Timeout to prevent indefinite loading
                setTimeout(() => {
                    if (changePasswordBtn.disabled) {
                        btnText.style.display = 'inline-block';
                        btnLoading.style.display = 'none';
                        changePasswordBtn.disabled = false;
                        changePasswordBtn.classList.remove('btn-loading-state');
                    }
                }, 8000);
            });
        }
    });
</script>
{% endblock %}