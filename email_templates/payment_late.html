{% load static %}
<!DOCTYPE html>
<html>
<head>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
        .container { max-width: 650px; margin: 20px auto; background: white; padding: 0; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%); color: white; padding: 30px 20px; text-align: center; }
        .header h2 { margin: 0 0 5px 0; font-size: 28px; }
        .header p { margin: 5px 0; font-size: 16px; opacity: 0.95; }
        .content { padding: 30px; }
        .status-box { background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); border-left: 5px solid #2196F3; padding: 20px; border-radius: 8px; margin-bottom: 25px; }
        .status-box h3 { margin: 0 0 15px 0; color: #1565c0; font-size: 18px; }
        .status-item { display: flex; align-items: center; margin: 12px 0; padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .status-item:last-child { border-bottom: none; }
        .status-icon { font-size: 24px; margin-right: 15px; min-width: 30px; }
        .status-text { flex: 1; }
        .status-text strong { color: #333; display: block; }
        .status-text span { color: #666; font-size: 14px; }
        
        .details { background: #fafafa; padding: 20px; border-radius: 8px; margin: 25px 0; border: 1px solid #e0e0e0; }
        .details h3 { margin: 0 0 15px 0; color: #333; font-size: 16px; }
        .details-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0; }
        .details-row:last-child { border-bottom: none; }
        .details-label { font-weight: 600; color: #666; }
        .details-value { color: #333; text-align: right; }
        
        .refund-box { background: linear-gradient(135deg, #fff9e6 0%, #fffacd 100%); border-left: 5px solid #fbc02d; padding: 20px; border-radius: 8px; margin: 25px 0; }
        .refund-box h3 { margin: 0 0 15px 0; color: #f57f17; font-size: 18px; }
        .refund-box p { margin: 10px 0; color: #333; line-height: 1.6; }
        .refund-amount { font-size: 24px; color: #f57f17; font-weight: bold; }
        .refund-timeline { background: white; padding: 15px; border-radius: 6px; margin-top: 15px; border: 1px solid #fbc02d; }
        
        .action-box { background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 5px solid #4caf50; padding: 20px; border-radius: 8px; margin: 25px 0; }
        .action-box h3 { margin: 0 0 15px 0; color: #2e7d32; font-size: 18px; }
        .action-box ol { margin: 0; padding-left: 20px; color: #333; }
        .action-box li { margin: 10px 0; line-height: 1.6; }
        
        .note-box { background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; padding: 15px; margin: 20px 0; }
        .note-box p { margin: 5px 0; color: #856404; font-size: 14px; }
        
        .footer { background: #f5f5f5; padding: 20px; text-align: center; border-top: 1px solid #e0e0e0; font-size: 12px; color: #999; }
        .footer p { margin: 5px 0; }
        
        .timestamp { font-size: 13px; color: #999; margin-top: 20px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>‚ö†Ô∏è Payment Received - Window Expired</h2>
            <p>Refund Has Been Initiated</p>
        </div>

        <div class="content">
            <p>Hello <strong>{{ user.first_name|default:"Valued Customer" }}</strong>,</p>

            <p style="font-size: 16px; color: #333; line-height: 1.6; margin: 20px 0;">
                We have received your payment for booking <strong>{{ booking.booking_number }}</strong>, but unfortunately it arrived <strong>after the 12-minute payment window expired</strong>. This means we cannot confirm your booking, but good news - <strong>your refund has been initiated!</strong>
            </p>

            <!-- Status Summary -->
            <div class="status-box">
                <h3>üìä Transaction Status Summary</h3>
                <div class="status-item">
                    <div class="status-icon">‚úÖ</div>
                    <div class="status-text">
                        <strong>Payment Received Successfully</strong>
                        <span>Payment ID: {{ payment_id }}</span>
                    </div>
                </div>
                <div class="status-item">
                    <div class="status-icon">‚è∞</div>
                    <div class="status-text">
                        <strong>Payment Time</strong>
                        <span>{{ payment_received_at|date:"d M, Y \a\t H:i:s" }}</span>
                    </div>
                </div>
                <div class="status-item">
                    <div class="status-icon">‚ùå</div>
                    <div class="status-text">
                        <strong>Window Expired At</strong>
                        <span>{{ expires_at|date:"d M, Y \a\t H:i:s" }} (12 minutes from payment initiation)</span>
                    </div>
                </div>
                <div class="status-item">
                    <div class="status-icon">üìå</div>
                    <div class="status-text">
                        <strong>Booking Status</strong>
                        <span style="color: #c41c3b; font-weight: bold;">Failed - Refund Initiated</span>
                    </div>
                </div>
            </div>

            <!-- Booking Details -->
            <div class="details">
                <h3>üé¨ Booking Details</h3>
                <div class="details-row">
                    <span class="details-label">Movie:</span>
                    <span class="details-value">{{ movie.title }}</span>
                </div>
                <div class="details-row">
                    <span class="details-label">Theater:</span>
                    <span class="details-value">{{ theater.name }}</span>
                </div>
                <div class="details-row">
                    <span class="details-label">Date:</span>
                    <span class="details-value">{{ showtime.date|date:"d M, Y" }}</span>
                </div>
                <div class="details-row">
                    <span class="details-label">Time:</span>
                    <span class="details-value">{{ showtime.start_time }}</span>
                </div>
                <div class="details-row">
                    <span class="details-label">Selected Seats:</span>
                    <span class="details-value">{{ booking.get_seats_display }}</span>
                </div>
                <div class="details-row">
                    <span class="details-label">Booking Amount:</span>
                    <span class="details-value" style="font-weight: bold; color: #d32f2f;">‚Çπ{{ booking.total_amount }}</span>
                </div>
            </div>

            <!-- Refund Box -->
            <div class="refund-box">
                <h3>üí∞ Refund Status</h3>
                <p>
                    Your payment of <span class="refund-amount">‚Çπ{{ booking.total_amount }}</span> 
                    <strong>has been marked for refund</strong> and will be credited back to your original payment method.
                </p>
                <div class="refund-timeline">
                    <strong style="color: #f57f17;">‚è≥ Refund Timeline:</strong>
                    <ul style="margin: 10px 0; padding-left: 20px; color: #333;">
                        <li><strong>Initiated:</strong> {{ "now"|date:"d M, Y \a\t H:i" }}</li>
                        <li><strong>Expected in Account:</strong> Within 24 hours (by {{ booking.created_at|date:"d M, Y" }})</li>
                        <li><strong>Processing Note:</strong> Some banks may take up to 48 hours for the amount to reflect</li>
                    </ul>
                </div>
            </div>

            <!-- Why This Happened -->
            <div class="note-box">
                <p><strong>Why did this happen?</strong></p>
                <p>
                    To ensure fair access to seats for all users, we reserve seats for only 12 minutes during the payment process. 
                    Your payment arrived after this window closed, so we cannot confirm your booking. However, since your payment 
                    was successfully received, we are processing a full refund without any deductions.
                </p>
            </div>

            <!-- Next Steps -->
            <div class="action-box">
                <h3>üîÑ What You Can Do Next</h3>
                <ol>
                    <li><strong>Try Again:</strong> Visit our website and select your desired seats again</li>
                    <li><strong>Faster Payment:</strong> Complete the payment within the 12-minute window this time</li>
                    <li><strong>Book Now:</strong> Availability may have changed, so check for your preferred shows</li>
                    <li><strong>Need Help?</strong> Contact our support team if you have any questions</li>
                </ol>
            </div>

            <p style="margin-top: 25px; color: #666; font-size: 14px;">
                <strong>Questions?</strong> If you have any concerns about this refund or your booking, 
                please reach out to our support team at <strong>support@moviebooking.com</strong> or call us at <strong>1-800-MOVIES-1</strong>.
            </p>

            <p style="margin-top: 20px; color: #333;">
                Best regards,<br>
                <strong>üé¨ Movie Booking System Team</strong>
            </p>
        </div>

        <div class="footer">
            <p>¬© 2026 Movie Booking System. All rights reserved.</p>
            <p>This is an automated email. Please do not reply to this email.</p>
            <div class="timestamp">
                Email sent: {{ "now"|date:"d M, Y H:i:s" }} IST
            </div>
        </div>
    </div>
</body>
</html>
